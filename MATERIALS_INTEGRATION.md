# Интеграция управления материалами

## Что было добавлено

### 1. Новые таблицы в Supabase

Созданы две новые таблицы:

- **materials_database** - База материалов с предустановленными значениями
- **materials_data** - Таблица для сохранения материалов из Excel

### 2. SQL для создания таблиц

Файл: `supabase/migrations/create_materials_tables.sql`

**ВАЖНО:** Выполните этот SQL в Supabase Dashboard перед использованием:

1. Откройте Supabase Dashboard
2. Перейдите в SQL Editor
3. Скопируйте содержимое файла `supabase/migrations/create_materials_tables.sql`
4. Выполните SQL запрос

### 3. Новые компоненты

- **MaterialsTableApp** (`src/components/MaterialsTableApp.tsx`) - Главный компонент для работы с материалами
- **useMaterialsData** (`src/hooks/useMaterialsData.ts`) - Хук для работы с данными материалов

### 4. Функционал

#### Основные возможности:
- ✅ Загрузка Excel файлов с материалами
- ✅ Автоматический подбор материалов из базы данных
- ✅ Редактирование ячеек двойным кликом
- ✅ Сохранение в Supabase
- ✅ Очистка базы данных
- ✅ Скрытие/показ колонок
- ✅ Расчет процента соответствия при подборе
- ✅ Статистика по материалам

#### Как работает подбор материалов:
1. Нажмите кнопку "Подбор материала" в заголовке таблицы
2. Система автоматически найдет похожие материалы из базы
3. Кликните на предложенный материал для его выбора
4. Цена и источник подставятся автоматически

### 5. Структура данных

#### materials_database (База материалов):
```sql
- id: UUID
- code: Код материала (уникальный)
- name: Наименование
- manufacturer: Производитель
- unit: Единица измерения
- price: Цена
- source: Источник (ETM.ru, База 1С, Tinko.ru)
```

#### materials_data (Сохраненные материалы):
```sql
- id: UUID
- position: Позиция
- name: Наименование
- type_mark_documents: Тип/марка
- equipment_code: Код оборудования
- manufacturer: Производитель
- unit: Единица измерения
- quantity: Количество
- material_picker: Выбранный материал
- price_unit: Единица измерения цены
- price: Цена
- source: Источник
- file_name: Имя файла
```

### 6. Использование

1. Перейдите на вкладку "Материалы"
2. Загрузите Excel файл или используйте демо-данные
3. Нажмите "Подбор материала" для автоматического подбора
4. Отредактируйте нужные поля (двойной клик)
5. Нажмите "Записать в Supabase" для сохранения

### 7. Предустановленные материалы

В базе уже есть 20 материалов:
- Светодиодные лампы и системы освещения
- Выключатели
- Кабели
- Распределительные коробки
- Прожекторы
- Опоры освещения
- Монтажные комплекты
- Автоматы дифференциальные

## Проверка работы

1. Запустите проект: `npm run dev`
2. Откройте http://localhost:5174 (или указанный порт)
3. Проверьте подключение к Supabase (зеленый индикатор)
4. Перейдите на вкладку "Материалы"
5. Загрузите Excel или используйте демо-данные
6. Протестируйте подбор и сохранение