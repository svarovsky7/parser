# Импорт товаров (Products Import)

## Описание

Модуль для импорта данных о товарах из CSV файлов в таблицу `products` базы данных Supabase.

## Структура таблицы products

```sql
CREATE TABLE products (
    id bigint PRIMARY KEY,
    name text NOT NULL,
    brand text NOT NULL,
    article text,
    brand_code text NOT NULL,
    cli_code text,
    class text NOT NULL,
    class_code bigint NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);
```

## Формат CSV файла

### Обязательные колонки:
- `id` - числовой идентификатор товара (уникальный)
- `name` - наименование товара (строка)
- `brand` - бренд товара (строка)
- `brand_code` - код бренда (строка)
- `class` - класс/категория товара (строка)
- `class_code` - код категории (число)

### Опциональные колонки:
- `article` - артикул товара (может быть пустым)
- `cli_code` - код клиента (может быть пустым)

### Пример CSV файла:

```csv
id,name,brand,article,brand_code,cli_code,class,class_code
1,"Ноутбук Dell Inspiron 15","Dell","INS-15-001","DELL","CLI001","Компьютеры",100
2,"Монитор Samsung 24''","Samsung","","SAMS","","Мониторы",200
3,"Клавиатура Logitech K120","Logitech","K120","LOGI","CLI003","Периферия",300
```

## Функциональность

### Импорт данных:
1. Выбор CSV файла через интерфейс
2. Автоматический парсинг и валидация данных
3. Предварительный просмотр импортируемых данных
4. Сохранение в базу данных с использованием upsert (обновление существующих записей)

### Валидация:
- Проверка обязательных полей
- Валидация типов данных (числа, строки)
- Проверка уникальности ID
- Детальные сообщения об ошибках

### Управление данными:
- Просмотр всех товаров в базе данных
- Возможность очистки всей таблицы
- Индикаторы загрузки и статуса операций

## Компоненты

### `ProductsImport.tsx`
Основной компонент страницы импорта товаров:
- Интерфейс загрузки файлов
- Таблица предварительного просмотра
- Управление импортом и отображение результатов
- Просмотр существующих товаров

### `useProductsData.ts`
Hook для работы с данными товаров:
- `importProducts()` - импорт массива товаров
- `fetchProducts()` - получение всех товаров
- `deleteAllProducts()` - очистка таблицы

### `csvParser.ts`
Утилита для парсинга CSV файлов:
- Поддержка стандартного CSV формата
- Обработка кавычек и экранирования
- Валидация данных и типов
- Детальные сообщения об ошибках

### Типы (`product.ts`)
- `Product` - полная структура товара из БД
- `ProductImport` - структура для импорта
- `ImportResult` - результат операции импорта

## Использование

1. Перейдите на вкладку "Товары" в приложении
2. Нажмите "Скачать пример CSV" для получения шаблона
3. Подготовьте ваш CSV файл согласно формату
4. Выберите файл через интерфейс "Выбрать файл"
5. Просмотрите данные в таблице предварительного просмотра
6. Нажмите "Импортировать в БД" для сохранения

## Миграции базы данных

Для создания таблицы `products` выполните миграцию:
```sql
-- Файл: supabase/migrations/create_products_table.sql
-- Содержит создание таблицы, индексов, RLS политик и триггеров
```

## Обработка ошибок

- Парсинг CSV: детальные сообщения о строках с ошибками
- Валидация: проверка типов данных и обязательных полей
- База данных: обработка конфликтов и ошибок подключения
- UI: индикаторы загрузки и уведомления пользователя